<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>לוח בקרה - מעקב מכולות מתקדם</title>
<style>
/* =============================================================================
   GEMINI-COMMAND (read this comment):
   - צור/הדבק את הקבצים הבאים:
     1) Code.gs (כפי שסופק) בפרויקט Apps Script שמחובר ל-SHEET ID הנתון.
     2) index.html (הקובץ הזה) כעמוד סטטי (github.io) או הכן לארח בתוך Apps Script.
   - וודא לפרוס Web App כ-"Anyone" ולקחת את ה-DEPLOY URL.
   - עדכן את הערך API_URL ב-JS למטה עם הכתובת.
   - ה-CSS למטה כולל הוראות עיצוב; שינויים ב-CSS כאן יושמו ישירות על ה־UI.
   =============================================================================*/

/* :root - ערכי צבעים וגדלים שניתן לשנות */
:root{
  --brand:#0b72b9;
  --accent:#ff9f1c;
  --success: #28a745;
  --danger: #dc3545;
  --warning: #ffc107;
  --bg:#f4f7fb;
  --card:#ffffff;
  --muted:#6b7280;
  --radius:12px;
  --shadow: 0 6px 18px rgba(10,25,47,0.08);
}

*{box-sizing:border-box}
body{
  margin:0; padding:24px; font-family: "Heebo", "Alef", Arial, sans-serif;
  background:var(--bg); color:#0b1721; direction:rtl;
  transition: background-color 0.3s;
}

/* Header */
.header{
  display:flex; gap:16px; align-items:center; justify-content:space-between;
  margin-bottom:24px;
}
.brand { display:flex; gap:12px; align-items:center; }
.logo{
  width:56px; height:56px; background:linear-gradient(135deg,var(--brand),#0369a1);
  border-radius:12px; box-shadow:var(--shadow); color:white; display:flex;
  align-items:center; justify-content:center; font-weight:700; font-size: 20px;
}
.controls { display:flex; gap:10px; align-items:center; }

/* layout */
.container { display:grid; grid-template-columns: 320px 1fr 380px; gap:20px; align-items:start; }
@media (max-width:1200px){ .container { grid-template-columns: 1fr 320px; .left { order: 2; } } }
@media (max-width:900px){ .container { grid-template-columns: 1fr; } .right, .left { order:99 } }

/* left panel (filters) */
.left { background:var(--card); padding:16px; border-radius:var(--radius); box-shadow:var(--shadow); }
.kpi { display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
.kpi-card { background:var(--bg); padding:16px; border-radius:10px; text-align:center; transition: transform 0.2s; }
.kpi-card:hover { transform: translateY(-3px); box-shadow: 0 4px 10px rgba(12,28,52,0.06); }
.kpi-number { font-size:24px; font-weight:700; color: var(--brand); }
.kpi-card .muted-text { color:var(--muted); font-size: 14px; }


/* center - main table */
.main { background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow); overflow: hidden; }
.toolbar { display:flex; gap:12px; align-items:center; padding: 12px 16px; background: #fcfdff; border-bottom: 1px solid #eef5fb;}
.search { flex:1; padding:10px 14px; border-radius:8px; border:1px solid #e6eef8; background:#fbfdff; font-size:15px; }
.table-wrapper { max-height: 70vh; overflow-y: auto; }
.table { width:100%; border-collapse:collapse; }
.table th, .table td { padding:12px 16px; border-bottom:1px solid #eef5fb; text-align:right; font-size:14px; white-space: nowrap; }
.table th { background:#f8fbff; font-weight:700; color:var(--brand); position: sticky; top: 0; z-index: 10; }
.table tbody tr { transition: background-color 0.2s; }
.table tbody tr:hover { background-color: #f7faff; }
.table .client-name { color: var(--brand); font-weight: 600; cursor: pointer; }
.table .client-name:hover { text-decoration: underline; }

/* Conditional Formatting */
.status-open { background-color: #fff; } /* ברירת מחדל */
.status-closed { background-color: #f0fdf4; color: #555; }
.status-overdue { background-color: #fff7f7; font-weight: bold; }
.status-overdue td:first-child { border-right: 4px solid var(--danger); }


/* right panel - notifications & tools */
.right { background:var(--card); padding:16px; border-radius:var(--radius); box-shadow:var(--shadow); }
.alert { background:#fff4f0; border-right:4px solid #ff8a4b; padding:12px; border-radius:8px; margin-bottom:10px; cursor: pointer; transition: box-shadow 0.2s, transform 0.2s; }
.alert:hover { box-shadow: 0 4px 12px rgba(255,159,28,0.15); transform: translateY(-2px); }
.note-area { width:100%; min-height:120px; padding:10px; border-radius:8px; border:1px solid #e6eef8; margin-top:10px; font-size:14px; }

/* Modals (Popups) */
.modal-overlay {
  position:fixed; top:0; left:0; width:100%; height:100%;
  background:rgba(10,25,47,0.4); z-index:100;
  display:flex; align-items:center; justify-content:center;
  opacity:0; visibility:hidden; transition: opacity 0.3s, visibility 0.3s;
}
.modal-overlay.visible { opacity:1; visibility:visible; }
.modal-content {
  background:var(--card); padding:24px; border-radius:var(--radius);
  box-shadow: 0 10px 30px rgba(10,25,47,0.1);
  width:90%; max-width:600px;
  transform: translateY(20px); transition: transform 0.3s;
}
.modal-overlay.visible .modal-content { transform: translateY(0); }
.modal-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:16px; }
.modal-header h2 { margin:0; font-size:20px; }
.modal-close { background:none; border:none; font-size:24px; cursor:pointer; color: var(--muted); }
.form-grid { display:grid; grid-template-columns: 1fr 1fr; gap:16px; }
.form-group { display:flex; flex-direction:column; }
.form-group label { margin-bottom:6px; font-size:14px; color: var(--muted); }
.form-group input, .form-group select { padding:10px; border:1px solid #e6eef8; border-radius:8px; font-size:15px; }
.form-group.full-width { grid-column: 1 / -1; }

/* CRM View Specifics */
.crm-grid { display:grid; grid-template-columns: 1fr 1fr; gap: 20px; }
.crm-card { background: #fcfdff; padding: 16px; border-radius: 10px; border: 1px solid #eef5fb; }
.crm-card h3 { margin-top:0; border-bottom: 1px solid #eef5fb; padding-bottom: 8px; font-size: 16px; }

/* small helpers */
.btn { background:var(--brand); color:white; border:none; padding:10px 16px; border-radius:8px; cursor:pointer; font-weight:600; font-size:15px; transition: background-color 0.2s, box-shadow 0.2s; }
.btn:hover { background: #0a61a0; box-shadow: 0 4px 10px rgba(11,114,185,0.2); }
.btn.secondary{ background:#e6f1fb; color:var(--brand); }
.btn.secondary:hover { background: #dceaf7; box-shadow: none; }
.btn.danger { background: var(--danger); }
.btn.danger:hover { background: #c82333; box-shadow: 0 4px 10px rgba(220,53,69,0.2); }
.modal-footer { margin-top:20px; display:flex; justify-content:flex-end; gap:10px; border-top: 1px solid #eef5fb; padding-top: 16px; }
.status-pill { padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 600; color: white; text-align: center; }

/* mobile adjustments */
@media (max-width:600px){
  body { padding: 12px; }
  .header { flex-direction:column; align-items:stretch; gap:12px; }
  .form-grid { grid-template-columns: 1fr; }
}
</style>
</head>
<body>
  <div class="header">
    <div class="brand">
      <div class="logo">ח.סבן</div>
      <div>
        <div style="font-weight:700;font-size:18px">לוח בקרה - מעקב מכולות</div>
        <div style="color:var(--muted);font-size:13px">חיבור לגליון: מעקב</div>
      </div>
    </div>
    <div class="controls">
      <input id="globalSearch" class="search" placeholder="חפש (מספר הזמנה, לקוח, כתובת...)" oninput="applyFilter()" />
      <button class="btn" onclick="refresh()">רענן</button>
      <button class="btn secondary" onclick="openNewOrderModal()">הזמנה חדשה +</button>
    </div>
  </div>

  <div class="container">
    <div class="left">
      <div style="font-weight:700;margin-bottom:12px">מדדי ביצוע (KPIs)</div>
      <div class="kpi">
        <div class="kpi-card"><div class="muted-text">סה״כ הזמנות</div><div id="kTotal" class="kpi-number">—</div></div>
        <div class="kpi-card"><div class="muted-text">פתוחות</div><div id="kOpen" class="kpi-number">—</div></div>
        <div class="kpi-card"><div class="muted-text">חורגות</div><div id="kOver" class="kpi-number" style="color:var(--danger)">—</div></div>
        <div class="kpi-card"><div class="muted-text">נסגרו היום</div><div id="kClosedToday" class="kpi-number" style="color:var(--success)">—</div></div>
      </div>

      <hr style="margin:20px 0" />
      <div style="font-weight:700;margin-bottom:6px">כלים ופיתוח</div>
      <div style="font-size:13px;color:var(--muted)">
        משימות, רעיונות או טיקטים מהירים לצוות הפיתוח.
      </div>
      <textarea id="devNote" class="note-area" placeholder="כתוב הערה/רשימת משימות..."></textarea>
      <div style="margin-top:10px; display:flex; gap:8px">
        <button class="btn" onclick="saveDevNote()">שמור הערה</button>
        <button class="btn secondary" onclick="loadDevNotes()">טען הערות</button>
      </div>
    </div>

    <div class="main">
      <div class="toolbar">
        <div style="font-weight:700; font-size: 18px;">טבלת הזמנות</div>
        <div style="flex:1"></div>
        <div id="statusMsg" style="color:var(--muted);font-size:13px"></div>
      </div>
      <div class="table-wrapper">
        <table class="table" id="ordersTable">
          <thead id="tHead"></thead>
          <tbody id="tBody"></tbody>
        </table>
      </div>
    </div>

    <div class="right">
      <div style="font-weight:700;margin-bottom:12px">התראות ומשימות</div>
      <div id="alerts"></div>

      <hr style="margin:20px 0" />
      <div style="font-weight:700">תוכנית פיתוח</div>
      <ul style="margin:8px 0 0 16px; font-size: 14px; line-height: 1.6;">
        <li>שילוב בזמן אמת (Firebase / WebSocket).</li>
        <li>אימות משתמשים והרשאות (roles).</li>
        <li>שיפור עריכת inline + bulk actions.</li>
        <li>יצוא PDF מעוצב + חתימה דיגיטלית.</li>
        <li>אינטגרציה מפות (Google Maps + geocoding).</li>
      </ul>
    </div>
  </div>

  <div id="newOrderModal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="modalTitle">יצירת הזמנה חדשה</h2>
        <button class="modal-close" onclick="closeModal('newOrderModal')">×</button>
      </div>
      <form id="orderForm" onsubmit="saveOrder(event)">
        <input type="hidden" id="editIndex" value="">
        <div id="formFields" class="form-grid">
          </div>
        <div class="modal-footer">
          <button type="button" class="btn secondary" onclick="closeModal('newOrderModal')">ביטול</button>
          <button type="submit" class="btn">שמור הזמנה</button>
        </div>
      </form>
    </div>
  </div>

  <div id="crmModal" class="modal-overlay">
    <div class="modal-content" style="max-width: 800px;">
      <div class="modal-header">
        <h2 id="crmClientName"></h2>
        <button class="modal-close" onclick="closeModal('crmModal')">×</button>
      </div>
      <div id="crmContent"></div>
       <div class="modal-footer">
          <button type="button" class="btn secondary" onclick="closeModal('crmModal')">סגור</button>
        </div>
    </div>
  </div>

<script>
/* ========== CONFIG ========== */
const API_URL = "https://script.google.com/macros/s/AKfycbyDj4xc2qeyX_g68ZY5RS81azER-XNKJxmEMg4Gu-qfeCHMByYtOaHntkNizx1KX_fB/exec"; // <-- החלף כאן בכתובת ה־WebApp שלך

/* ========== STATE MANAGEMENT ========== */
let rawData = [];
let headers = [];
const clientNameFields = ["שם לקוח", "לקוח", "client name", "customer"];
const statusFieldIdentifier = "סטטוס";
const dateFieldIdentifier = "תאריך סיום";

/* ========== API HELPERS ========== */
async function apiCall(method, body) {
  const url = method === "GET" ? `${API_URL}?action=${body.action}` : API_URL;
  const options = {
    method: method,
    headers: { "Content-Type": "application/json" },
  };
  if (method === "POST") {
    options.body = JSON.stringify(body);
  }
  try {
    const res = await fetch(url, options);
    if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
    return await res.json();
  } catch (err) {
    console.error("API Call Error:", err);
    showStatus(`שגיאת רשת: ${err.message}`, true);
    return { status: "error", message: err.message };
  }
}

/* ========== DATE & FORMATTING UTILS ========== */
function formatDateTime(value) {
  if (!value && value !== 0) return "";
  let d = (value instanceof Date) ? value : new Date(value);
  if (isNaN(d.getTime())) return value;
  return d.toLocaleDateString("he-IL", { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit', hour12: false }).replace(',', '');
}

function isDateHeader(h) {
  if (!h) return false;
  const s = String(h).toLowerCase();
  return s.includes("תאריך") || s.includes("date");
}

/* ========== UI RENDERING ========== */
function renderTable(data, hdrs) {
    headers = hdrs;
    const tbody = document.getElementById("tBody");
    const thead = document.getElementById("tHead");
    
    thead.innerHTML = `<tr>${hdrs.map(h => `<th>${h}</th>`).join("")}<th>פעולות</th></tr>`;
    tbody.innerHTML = data.map((row, idx) => {
        const status = row[statusFieldIdentifier] || "";
        const endDate = row[dateFieldIdentifier] ? new Date(row[dateFieldIdentifier]) : null;
        const isOverdue = endDate && endDate < new Date() && status.toLowerCase() !== 'סגור';

        let rowClass = 'status-open';
        if (isOverdue) rowClass = 'status-overdue';
        else if (status.toLowerCase().includes('סגור')) rowClass = 'status-closed';

        const cells = hdrs.map(h => {
            const v = row[h] === null || row[h] === undefined ? "" : row[h];
            const clientNameField = clientNameFields.find(name => h.toLowerCase() === name.toLowerCase());

            if (clientNameField) {
                return `<td class="client-name" onclick="openCrmView('${v}')">${v}</td>`;
            }
            if (h === statusFieldIdentifier) {
                return `<td><span class="status-pill" style="background-color: ${getStatusColor(v)}">${v}</span></td>`;
            }
            if (isDateHeader(h)) {
                return `<td>${formatDateTime(v)}</td>`;
            }
            if (String(h).includes("טלפון") && v) {
                return `<td><a href="tel:${v}">${v}</a></td>`;
            }
            if (String(h).includes("כתובת") && v) {
                return `<td><button class="btn secondary" style="padding: 6px 10px;" onclick="openMap('${encodeURIComponent(v)}')">מפה</button></td>`;
            }
            return `<td>${v}</td>`;
        }).join("");

        const actions = `
            <td>
                <button class="btn secondary" style="padding: 6px 10px;" onclick="openEditOrderModal(${rawData.findIndex(r => r === row)})">ערוך</button>
            </td>`;
            
        return `<tr class="${rowClass}">${cells}${actions}</tr>`;
    }).join("");
}

function getStatusColor(status) {
    const s = String(status).toLowerCase();
    if (s.includes('סגור')) return 'var(--success)';
    if (s.includes('בתהליך')) return 'var(--accent)';
    if (s.includes('חדש')) return 'var(--brand)';
    return 'var(--muted)';
}


function computeKPIs(data, hdrs) {
  const total = data.length;
  const today = new Date();
  today.setHours(0, 0, 0, 0);

  const open = data.filter(r => !String(r[statusFieldIdentifier] || "").toLowerCase().includes("סגור")).length;
  
  const overdue = data.filter(r => {
      const endDate = r[dateFieldIdentifier] ? new Date(r[dateFieldIdentifier]) : null;
      return endDate && endDate < today && !String(r[statusFieldIdentifier] || "").toLowerCase().includes("סגור");
  });

  const closedToday = data.filter(r => {
    // Assuming there's a "תאריך סגירה" or similar field. If not, this logic needs adjustment.
    const closedDateField = hdrs.find(h => h.includes("סגירה")) || dateFieldIdentifier;
    const closedDate = r[closedDateField] ? new Date(r[closedDateField]) : null;
    return String(r[statusFieldIdentifier] || "").toLowerCase().includes("סגור") && closedDate && closedDate >= today;
  }).length;
  
  document.getElementById("kTotal").innerText = total;
  document.getElementById("kOpen").innerText = open;
  document.getElementById("kOver").innerText = overdue.length;
  document.getElementById("kClosedToday").innerText = closedToday;

  // Render alerts
  const alertsContainer = document.getElementById("alerts");
  alertsContainer.innerHTML = overdue.length === 0 
    ? "<div style='color:var(--muted)'>אין חריגות פעילות</div>"
    : overdue.slice(0, 5).map(o => {
        const clientName = clientNameFields.map(f => o[f]).find(name => name) || "לקוח לא ידוע";
        const endDate = formatDateTime(o[dateFieldIdentifier]);
        const originalIndex = rawData.findIndex(item => item === o);
        return `<div class="alert" onclick="highlightAndShowOrder(${originalIndex})">
                    <div style="font-weight:700">${clientName}</div>
                    <div style="font-size:13px">תאריך סיום חלף: ${endDate}</div>
                </div>`;
      }).join("");
}

function highlightAndShowOrder(index) {
    // This is a placeholder for a more advanced function.
    // For now, it can just scroll to the row.
    const tableRows = document.querySelectorAll('#tBody tr');
    if (tableRows[index]) {
        tableRows[index].scrollIntoView({ behavior: 'smooth', block: 'center' });
        tableRows[index].style.transition = 'background-color 0.5s';
        tableRows[index].style.backgroundColor = 'var(--warning)';
        setTimeout(() => { tableRows[index].style.backgroundColor = ''; }, 2000);
    }
}


/* ========== CORE ACTIONS ========== */
async function refresh() {
  showStatus("טוען נתונים...", false);
  const resp = await apiCall("GET", { action: "getData" });
  if (resp.status === "success") {
    rawData = resp.data || [];
    renderTable(rawData, resp.headers);
    computeKPIs(rawData, resp.headers);
    showStatus(`נטענו ${rawData.length} רשומות`, false);
  } else {
    showStatus(`שגיאה בטעינה: ${resp.message}`, true);
  }
}

function applyFilter() {
  const query = document.getElementById("globalSearch").value.trim().toLowerCase();
  const filtered = query === "" ? rawData : rawData.filter(row => 
    Object.values(row).some(val => String(val || "").toLowerCase().includes(query))
  );
  renderTable(filtered, headers);
}

/* ========== MODAL & FORM MANAGEMENT ========== */
function openModal(modalId) {
  document.getElementById(modalId).classList.add('visible');
}
function closeModal(modalId) {
  document.getElementById(modalId).classList.remove('visible');
}

function generateFormFields(data = {}) {
  const formFields = document.getElementById('formFields');
  formFields.innerHTML = headers.map(h => {
    const value = data[h] || '';
    let inputType = 'text';
    if (isDateHeader(h)) inputType = 'datetime-local';
    
    // Example for a status dropdown
    if (h === statusFieldIdentifier) {
        return `
            <div class="form-group full-width">
                <label for="field-${h}">${h}</label>
                <select id="field-${h}" required>
                    <option value="חדש" ${value === 'חדש' ? 'selected' : ''}>חדש</option>
                    <option value="בתהליך" ${value === 'בתהליך' ? 'selected' : ''}>בתהליך</option>
                    <option value="סגור" ${value === 'סגור' ? 'selected' : ''}>סגור</option>
                </select>
            </div>`;
    }

    return `
      <div class="form-group ${headers.length % 2 !== 0 && headers.indexOf(h) === headers.length - 1 ? 'full-width' : ''}">
        <label for="field-${h}">${h}</label>
        <input type="${inputType}" id="field-${h}" value="${inputType === 'datetime-local' && value ? new Date(value).toISOString().slice(0,16) : value}">
      </div>`;
  }).join('');
}

function openNewOrderModal() {
  document.getElementById('modalTitle').innerText = 'יצירת הזמנה חדשה';
  document.getElementById('editIndex').value = '';
  document.getElementById('orderForm').reset();
  generateFormFields();
  openModal('newOrderModal');
}

function openEditOrderModal(index) {
  const rowData = rawData[index];
  if (!rowData) return;
  document.getElementById('modalTitle').innerText = 'עריכת הזמנה';
  document.getElementById('editIndex').value = index;
  generateFormFields(rowData);
  openModal('newOrderModal');
}

async function saveOrder(event) {
  event.preventDefault();
  const index = document.getElementById('editIndex').value;
  const isEdit = index !== '';

  const rowData = headers.map(h => document.getElementById(`field-${h}`).value);
  
  const action = isEdit ? 'updateRow' : 'addRow';
  const body = { action, row: rowData };
  if (isEdit) body.index = parseInt(index) + 1; // 1-based index for sheets

  showStatus('שומר נתונים...', false);
  const resp = await apiCall('POST', body);
  if (resp.status === 'success') {
    closeModal('newOrderModal');
    await refresh();
    showStatus(resp.message, false);
  } else {
    showStatus(`שגיאה בשמירה: ${resp.message}`, true);
  }
}

/* ========== CRM VIEW ========== */
function openCrmView(clientName) {
    const clientOrders = rawData.filter(row => {
        const nameInRow = clientNameFields.map(f => row[f]).find(name => name);
        return nameInRow === clientName;
    });

    if (clientOrders.length === 0) return;

    document.getElementById('crmClientName').innerText = `כרטיס לקוח: ${clientName}`;
    const content = document.getElementById('crmContent');
    
    const clientDetails = clientOrders[0]; // Assume details are the same across orders
    
    content.innerHTML = `
        <div class="crm-grid">
            <div class="crm-card">
                <h3>פרטים אישיים</h3>
                <p><strong>טלפון:</strong> ${clientDetails['טלפון'] || 'לא זמין'}</p>
                <p><strong>כתובת ראשית:</strong> ${clientDetails['כתובת'] || 'לא זמין'}</p>
            </div>
            <div class="crm-card">
                <h3>סיכום הזמנות</h3>
                <p><strong>סה"כ הזמנות:</strong> ${clientOrders.length}</p>
                <p><strong>הזמנות פתוחות:</strong> ${clientOrders.filter(o => o.סטטוס !== 'סגור').length}</p>
            </div>
        </div>
        <div class="crm-card" style="margin-top: 20px;">
            <h3>היסטוריית הזמנות</h3>
            <div class="table-wrapper" style="max-height: 250px;">
                <table class="table">
                    <thead>
                        <tr>
                            <th>${dateFieldIdentifier}</th>
                            <th>${statusFieldIdentifier}</th>
                            <th>פעולה</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${clientOrders.map(o => `
                            <tr>
                                <td>${formatDateTime(o[dateFieldIdentifier])}</td>
                                <td>${o[statusFieldIdentifier]}</td>
                                <td><button class="btn secondary" style="padding: 4px 8px;" onclick="highlightAndShowOrder(${rawData.findIndex(item => item === o)})">הצג</button></td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            </div>
        </div>
    `;

    openModal('crmModal');
}

/* ========== OTHER ACTIONS ========== */
function openMap(q) {
  window.open(`https://www.google.com/maps/search/?api=1&query=${q}`, "_blank");
}

async function saveDevNote() {
  const text = document.getElementById("devNote").value.trim();
  if (!text) { alert("יש לכתוב תוכן להערה."); return; }
  const resp = await apiCall("POST", { action: "saveDevNote", note: { author: "Admin", text: text } });
  alert(resp.message || "ההערה נשמרה");
  document.getElementById("devNote").value = "";
}

async function loadDevNotes() {
  const resp = await apiCall("GET", { action: "getDevNotes" });
  if (resp.status === "success" && resp.notes && resp.notes.length) {
    const notesText = resp.notes.slice(-5).reverse().map(n => `[${formatDateTime(n.timestamp)}] ${n.author}: ${n.note}`).join("\n---\n");
    document.getElementById("devNote").value = notesText;
  } else {
    alert("לא נמצאו הערות קודמות.");
  }
}

function showStatus(message, isError) {
  const statusEl = document.getElementById("statusMsg");
  statusEl.innerText = message;
  statusEl.style.color = isError ? "var(--danger)" : "var(--muted)";
  if (!isError) {
    setTimeout(() => { statusEl.innerText = ""; }, 4000);
  }
}

/* ========== INITIALIZATION ========== */
document.addEventListener('DOMContentLoaded', refresh);
</script>
</body>
</html>
